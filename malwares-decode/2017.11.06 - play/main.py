#!/usr/bin/env python3

import sys

if len(sys.argv) > 1:

    # get filename from command line
    filename = sys.argv[1]

    # read file as utf-16
    print('\n--- wczytane z plik (jako Unicode) ---\n')
    data = open(filename, encoding='utf16').read()
    print(data)
    
    # find substring to conversion
    print('\n--- wycinek po "Smok = " ---\n')
    start = data.find('Smok = "') + len('Smok = "')
    end   = data.find('" :', start)
    data = data[start:end]
    print(data)

    # second string
    e = "x2oiAr8DAdlrwGkSSx"

    # decode base64 and decode utf-16 into Unicode
    print('\n--- konwersja ---\n')

    # convert e to p
    #p = 0
    #for x in e:
    #    p = p + ord(x)

    p = sum(ord(x) for x in e)
    #p = sum(map(ord, e))

    print(p)
    
    # convert data
    #s = ""
    #for x in data:
    #    s = s + chr(ord(x) - p + len(e))

    p -= len(e)
    s = ''.join(chr(ord(x)-p) for x in data)
    #s = ''.join(map(lambda x:chr(ord(x)-p), data))

    print(s)

